import java.awt.BorderLayout;
import java.awt.Button;
import java.awt.GridLayout;
import java.awt.List;
import java.awt.Panel;
import java.awt.TextField;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.IOException;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.net.Socket;
import java.util.Random;
import java.io.InputStream;
import java.io.InputStreamReader;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JTextField;
class WaitingRoom extends JFrame implements ActionListener, MouseListener{
	
	List list1, list2;
	JTextField tf1;
	JButton b;
	Socket s;
	BufferedWriter bw;
	BufferedReader br;
	String id;
	Room room;
	WaitingRoom(String id)
	{
		super(id +"Welcome");
		this.id = id;
		
		list1 = new List();
		list2 = new List();
		tf1 = new JTextField();
		b= new JButton("Create a room");
		b.addActionListener(this);
		
		list1.addActionListener(this);
	    JPanel p1 = new JPanel();
		p1.setLayout(new GridLayout(1, 2));
		JPanel p2 = new JPanel();
		p2.setLayout(new BorderLayout());
		
		p1.add(list1);
		p1.add(list2);
		
		p2.add(tf1);
		p2.add(b, "East");
		
		add(p1);
		add(p2, "South");
	}
	
	void stop() throws IOException {
		s.close();
	}
	
	void initNet() throws Exception {
		s = new Socket("localhost", 8888);
		InputStream is = s.getInputStream();
		OutputStream os = s.getOutputStream();
		InputStreamReader isr = new InputStreamReader(is);
		br = new BufferedReader(isr);
		
		OutputStreamWriter osw = new OutputStreamWriter(os);
		bw = new BufferedWriter(osw);
		
		SendMsg("enter/" + id);
	}
	@Override
	public void actionPerformed(ActionEvent arg0) {
		// TODO Auto-generated method stub
	try {
		setVisible(false);
		dispose();
		room = new Room(id, tf1.getText(), this);
		room.setBounds(200, 200, 400, 300);
		room.setVisible(true);
	} catch (Exception e1) {
		// TODO: handle exception
		e1.printStackTrace();
	}	
	}
	
	void SendMsg(String msg) throws Exception {
		try {
			bw.write(msg + "\n");
			bw.flush();
		} catch (Exception ee) {
			// TODO: handle exception
			ee.printStackTrace();
		}
	}
	
	public void readMsg() {
		try {
			while(true)
			{
				String line = br.readLine();
				System.out.println(line);
				String[] array = line.split("/");
				
				switch(array[0])
				{
				case "guestlist" :
					list2.removeAll();
					int len = array.length;
					
					for(int i=1; i < len; i++)
					list2.add(array[i]);
					
					break;
					
				case "roomlist" :
					list1.removeAll();
					len = array.length;
					
					for(int i=1; i<len; i++)
						list1.add(array[i]);
					break;
					
				case "roomnum" :
					len = array.length;
					
					for(int i=1; i<len; i++)
						list1.replaceItem(list1.getItem(i-1)+"//"+array[i]+"people", i-1);
					
					break;
					
				case "guestlistRoom" :
					room.list.removeAll();
					int len2 = array.length;
					for(int i=1; i<len2;i++){
						room.list.add(array[i]);
					}
						break;
						
				case "out" :
					room.list.remove(array[1]);
					break;
					
				case "msg" :
					System.out.println("Recevied Message");
					room.ta.append("["+array[1]+"]"+array[2]+"\n");
					break;
					
				}
			}
		} catch (Exception e) {
			System.out.println("Errer is occured during reading" + e.getMessage());
			e.printStackTrace();
			// TODO: handle exception
		}
	}
	@Override
	public void mouseClicked(MouseEvent e) {
		// TODO Auto-generated method stub
		if(e.getClickCount()==2)
		{
			try {
				
				String roomname[] = list1.getSelectedItem().split("/");
				setVisible(false);
				dispose();
				room = new Room(id,roomname[0], this);
				room.setBounds(200, 200, 400, 300);
				room.setVisible(true);
				
				SendMsg("roomjoin/" + id + "/" + roomname[0]);
				
			} catch (Exception e1) {
				// TODO: handle exception
				e1.printStackTrace();
			}
		}
		
		
	}
	@Override
	public void mouseEntered(MouseEvent arg0) {
		// TODO Auto-generated method stub
		
	}
	@Override
	public void mouseExited(MouseEvent arg0) {
		// TODO Auto-generated method stub
		
	}
	@Override
	public void mousePressed(MouseEvent arg0) {
		// TODO Auto-generated method stub
		
	}
	@Override
	public void mouseReleased(MouseEvent arg0) {
		// TODO Auto-generated method stub
		
	}
	
	public static void main(String args[]) throws Exception {
		Random rc = new Random();
		WaitingRoom client = new WaitingRoom(args[0]+rc.nextInt(10)*1);
		client.initNet();
		client.setBounds(200, 200, 400, 300);
		client.setVisible(true);
		client.readMsg();
	}
	

}
