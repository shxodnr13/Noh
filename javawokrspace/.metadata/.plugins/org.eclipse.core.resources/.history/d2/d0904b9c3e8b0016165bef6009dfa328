import javax.swing.*;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.awt.*;
import java.awt.event.*;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.*;

public class Login extends JFrame implements ActionListener
{
	public static int admincheck;
	JButton SUBMIT, SIGNUP;
	JPanel panel;
	JLabel label1, label2;
	final JTextField text1;
	JPasswordField text2;
	Login()
	{
		int admincheck1 = admincheck;
		label1 = new JLabel();
		label1.setText("Username");
		text1 = new JTextField(15);
		
		label2 = new JLabel();
		label2.setText("Password");
		text2 = new JPasswordField(15);
		
		SUBMIT = new JButton("sign in");
		SIGNUP = new JButton("sign up");
		
		panel = new JPanel(new GridLayout(3,1));
		panel.add(label1);
		panel.add(text1);
		panel.add(label2);
		panel.add(text2);
		panel.add(SUBMIT);
		panel.add(SIGNUP);
		add(panel, BorderLayout.CENTER);
		SUBMIT.addActionListener(this);
		SIGNUP.addActionListener(this);
		setTitle("LOGIN FORM");		
	}
	
	
	
	
	
	

	public static void main(String[] args) {
		// TODO Auto-generated method stub

	}







	@Override
	public void actionPerformed(ActionEvent ae) {
		// TODO Auto-generated method stub
		String value = text1.getText();
		String value2 = text2.getText();
		Object src = ae.getSource();
		if(src==SUBMIT){
			Connection con = null;
			PreparedStatement pstm = null;
			try {
				String url = "jdbc:mysql://localhost:3306/tw1";
				String id="root";
				String pw = "!1234abcd";
				
				Class.forName("com.mysql.jdbc.Driver");
				
				con=DriverManager.getConnection(url,id,pw);
				
				System.out.println("제대로 연결되었습니다");
		
				pstm = con.prepareStatement("SELECT * FROM login where id=? and password=PASSWORD(?)");
				pstm.setString(1, text1.getText());
				pstm.setString(2, text2.getText());
				ResultSet rs = pstm.executeQuery();
			
				
				if(true==rs.next()) {
					admincheck = rs.getInt("admin");
					if(admincheck == 3){
						System.out.println("로그인 성공");
						Main mai = new Main();
						mai.pack();
						mai.setVisible(true);
						mai.getContentPane();
						dispose();
								
						/*NextPage page = new NextPage();			
						page.setVisible(true);
						JLabel label = new JLabel("Welcome:" + value + "권한 : " +  "Administrator");
						page.getContentPane().add(label);
						dispose(); */
					}
					}
					else{
						
					}
						
				
			
			} catch(Exception e){
				e.printStackTrace();
				System.out.println("실패");
			} finally {
				if(pstm != null) try {pstm.close();} catch(SQLException sqle){}
				if(pstm != null) try {con.close();} catch(SQLException sqle){}
			}
			
			
			
			
			
			
			
			
		
	}
		else if(src==SIGNUP) {
			SignUp signup = new SignUp();
			signup.setVisible(true);
			
		}
	}

}
class LoginDemo 
{
	public static void main(String arg[] )
	{
	
		try
		{
			
			Login frame = new Login();
			frame.setSize(300, 100);
			frame.setVisible(true);
		} catch(Exception e)
		{JOptionPane.showMessageDialog(null, e.getMessage());}
	
}
}